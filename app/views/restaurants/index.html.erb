<div id='restaurant_box' >
  <% if @restaurants.any? %>
    <% @restaurants.each do |restaurant| %>
      <h1>
        <%= image_tag restaurant.image.url(:thumb) %>
        <div id='restaurant_name'><%= link_to restaurant.name, restaurant_path(restaurant) %></div>
        <div id='rating_box'>Average rating: <%= star_rating(restaurant.average_rating) %></div>
      </h1>
      <% if can? :update, restaurant %>
        <%= link_to "Edit #{restaurant.name}", edit_restaurant_path(restaurant) %>
      <% end %>
     
      <% if can? :destroy, restaurant %>
        <%= link_to "Delete #{restaurant.name}", restaurant_path(restaurant), method: :delete %>
      <% end %>
      <% unless restaurant.reviews.find_by(user: current_user) %>
        <%= link_to "Review #{restaurant.name}", new_restaurant_review_path(restaurant)%>
      <%end%>

      <h3>Reviews for <%= restaurant.name %></h3>
      <% if restaurant.reviews.any? %>
        <ul>
          <% restaurant.reviews.each do |review| %>
            <li>
              <%= review.thoughts %>, <strong><%= review.rating %></strong>/5
              <%= link_to "Endorse Review", review_endorsements_path(review), class: 'endorsements-link' %>
              <span class="endorsements_count"> <%= review.endorsements.count %> </span> <%= 'endorsement'.pluralize(review.endorsements.count) %>
              <% if can? :destroy, review %>
                <%= link_to "Delete #{restaurant.name} review", review_path(review), method: :delete %>
              <%end%>
            </li>
           <% end %>
        </ul>
      <% else %>
        <p>No reviews.</p>
      <% end %>
    <% end %>
  <% else %>
    No restaurants yet 
  <% end %>
</div>

<a href='/restaurants/new'>Add a restaurant</a>
